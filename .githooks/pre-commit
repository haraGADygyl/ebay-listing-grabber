#!/bin/sh
#
# pre-commit hook â€” runs ruff linting and format checking on staged Python files.
#

# Get staged .py files (excludes deleted files)
staged_files=$(git diff --cached --name-only --diff-filter=d -- '*.py')

if [ -z "$staged_files" ]; then
    exit 0
fi

errors=0

# Lint
echo "Running ruff check..."
if ! uv run ruff check $staged_files; then
    echo ""
    echo "  Lint errors found. Run 'uv run ruff check --fix' to auto-fix."
    echo ""
    errors=1
fi

# Format check
echo "Running ruff format --check..."
if ! uv run ruff format --check $staged_files; then
    echo ""
    echo "  Formatting issues found. Run 'uv run ruff format' to fix."
    echo ""
    errors=1
fi

if [ "$errors" -ne 0 ]; then
    echo "pre-commit: aborting commit due to lint/format errors."
    exit 1
fi
